---
title: "Testing the pitch commonality algorithm"
author: "Peter M. C. Harrison"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
bibliography: bib.bib
csl: apa.csl
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(ggplot2)
library(HarmonyParncutt)
library(HarmonyToolbox)
library(magrittr)
library(parallel)

data("bigand_1996", package = "HarmonyParncutt")
data("bigand_1996_reference_chord", package = "HarmonyParncutt")

theme_set(theme_bw() +
            theme(panel.grid.major = element_blank(),
                  panel.grid.minor = element_blank(),
                  strip.background = element_rect(fill = "white")))
```

This report compares this package's implementation of Parncutt's pitch commonality algorithm with the results reported in @Bigand1996.

## Method

@Bigand1996 provide tables of metadata for the chords they used in their experiment. These tables don't actually say what the precise pitches in the chords are, but it is possible to deduce these pitches from the provided metadata. These chords and their metadata can be found in the dataset `bigand_1996`. We can use this data to compare implementations of Parncutt's pitch commonality algorithm.

## Results

```{r, include = TRUE, cache = TRUE}
df <- bigand_1996 %>%
  (function(df) {
    df$pitch_commonality_new <- mclapply(
      df$pitches, function(pitches) {
        get_pitch_commonality(
          chord_1 = as.numeric(bigand_1996_reference_chord),
          chord_2 = pitches
        )
      }
    ) %>% as.numeric
    df
  })

ggplot(df, aes(x = pitch_commonality_new, y = pitch_commonality)) +
  geom_point() +
  scale_x_continuous("New implementation") +
  scale_y_continuous("Bigand et al. (1996) implementation")
```

The two sets of values are highly correlated (`r apa::apa(cor.test(df$pitch_commonality, df$pitch_commonality_new))`). The differences between the results are likely to be down to the slightly different methodologies underpinning the algorithms; @Bigand1996 use the algorithm from @Parncutt1989, whereas we use the algorithm from @Parncutt1994, which uses a slightly different similarity measure for the two pitch salience profiles.

## References
